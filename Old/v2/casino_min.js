function Game(){this.stoppedRunning=!1,this.mX=0,this.mY=0,this.cursorMode="move",this.movingObject=0,this.pause=!1,this.selectedGame=0,this.bgC=document.getElementById("bgC"),this.bgCxt=this.bgC.getContext("2d"),this.mgC=document.getElementById("mgC"),this.mgCxt=this.mgC.getContext("2d"),this.fgC=document.getElementById("fgC"),this.fgCxt=this.fgC.getContext("2d"),this.personInfo=document.getElementById("personInfo"),this.casinoGameInfo=document.getElementById("gameInfo"),this.casinoInfo=document.getElementById("casinoInfo");var a=new Array;a.slots=100,a.blackjack=250,a.craps=500,a.roulette=150,SLOTSCOST=100;var b=0;this.attendance=0,this.amountOfDoodads=0,this.people=new Array(MaxAttendance),this.cash=1e3,this.popularity=50,this.casinoGames=new Array(100),this.doodads=new Array(500),this.init=function(){for(var a=0;MaxAttendance>a;a++)this.attendance<StartingAttendance?(this.people[a]=new Person,this.people[a].init(doorX,doorY,this.fgC,this.fgCxt),this.attendance++):this.people[a]=0;for(var a=0;MaxGames>a;a++)this.casinoGames[a]=0;for(var a=0;500>a;a++)this.doodads[a]=0},this.update=function(){if(b++,this.popularity>100?this.popularity=100:this.popularity<0&&(this.popularity=0),0==this.pause){for(var a=0;MaxAttendance>a;a++)0!=this.people[a]&&this.people[a].update(),1==this.people[a].gone&&(delete this.people[a],this.people[a]=0,this.attendance--);for(var a=0;MaxGames>a;a++)0!=this.casinoGames[a]&&this.casinoGames[a].update();if(0==b%180){var c=100*Math.random();if(this.popularity>c)for(var a=0;MaxAttendance>a;a++)if(0==this.people[a]){this.people[a]=new Person,this.people[a].init(doorX,doorY,this.fgC,this.fgCxt),this.attendance++;break}}if(Math.random()<1e-4){var d=Math.ceil(200*Math.random());Math.random()>.5?(alert(goodEvents[Math.floor(2*Math.random())]),this.cash+=d,alert("You gained $"+d+"!")):(alert(badEvents[Math.floor(3*Math.random())]),this.cash-=d,alert("You lost $"+d+"!"))}}document.getElementById("casinoCash").innerHTML="$"+this.cash,document.getElementById("casinoAttendance").innerHTML=this.attendance,document.getElementById("casinoPopularity").innerHTML=this.popularity+"%"},this.draw=function(){this.fgCxt.clearRect(0,0,640,480);for(var a=0;MaxAttendance>a;a++)0!=this.people[a]&&this.people[a].draw();this.fgCxt.drawImage(doorImage,doorX,doorY),"move"==this.cursorMode?this.fgCxt.drawImage(crossImage,this.mX-16,this.mY-16):"select"==this.cursorMode&&this.fgCxt.drawImage(magnifyingImage,this.mX-16,this.mY-16),("move"==this.cursorMode||"sell"==this.cursorMode)&&this.mgCxt.clearRect(0,0,640,480);for(var a=0;MaxGames>a;a++)0!=this.casinoGames[a]&&this.casinoGames[a].draw();this.bgCxt.fillRect(0,0,640,480),this.bgCxt.fillStyle=floorPattern;for(var a=0;500>a;a++)0!=this.doodads[a]&&this.doodads[a].draw();this.cash<=0&&(this.fgCxt.font="30px Arial",this.fgCxt.fillStyle="#0026FF",this.fgCxt.fillText("You have gone bankrupt!  Refresh to play again!",0,240),this.pause=!0)},this.run=function(){this.update(),this.draw()},this.mouseClicked=function(){if("select"==this.cursorMode){for(var c=!0,d=0;MaxGames>d;d++)0!=this.casinoGames[d]&&(this.mouseWithinBounds(this.casinoGames[d].x,this.casinoGames[d].y,this.casinoGames[d].width,this.casinoGames[d].height)?(this.selectedGame=this.casinoGames[d],this.casinoGames[d].selected=!0,c=!1,document.getElementById("gameWinRate").value=this.casinoGames[d].winRate,document.getElementById("gameCashOut").value=this.casinoGames[d].cashOut,document.getElementById("gameCostToPlay").value=this.casinoGames[d].costToPlay,document.getElementById("gameUpKeep").innerHTML="$"+this.casinoGames[d].upKeep,document.getElementById("gameMaxPlayers").innerHTML=this.casinoGames[d].maxPlayers,this.casinoInfo.style.display="none",this.casinoGameInfo.style.display="block",this.personInfo.style.display="none"):(this.mgCxt.clearRect(0,0,640,480),this.casinoGames[d].selected=!1));if(1==c)for(var d=0;MaxAttendance>d;d++)0!=this.people[d]&&(this.mouseWithinBounds(this.people[d].x,this.people[d].y,16,16)?(this.people[d].selected=!0,c=!1,document.getElementById("personMood").innerHTML=this.people[d].mood+"%",document.getElementById("personCash").innerHTML="$"+this.people[d].cash,document.getElementById("personThought").innerHTML=this.people[d].thought,document.getElementById("personTemp").innerHTML=this.people[d].temperament,this.casinoInfo.style.display="none",this.casinoGameInfo.style.display="none",this.personInfo.style.display="block"):this.people[d].selected=!1);1==c&&(this.casinoInfo.style.display="block",this.personInfo.style.display="none",this.casinoGameInfo.style.display="none")}else if("move"==this.cursorMode)if(0==this.movingObject){for(var d=0;500>d;d++)0!=this.doodads[d]&&(this.mouseWithinBounds(this.doodads[d].x,this.doodads[d].y,16,16)?(this.doodads[d].selected=!0,this.movingObject=this.doodads[d]):this.doodads[d].selected=!1);for(var d=0;MaxGames>d;d++)if(0!=this.casinoGames[d]){if(this.mouseWithinBounds(this.casinoGames[d].x,this.casinoGames[d].y,this.casinoGames[d].width,this.casinoGames[d].height)){0!=this.movingObject&&(this.movingObject.selected=!1),this.casinoGames[d].selected=!0,this.movingObject=this.casinoGames[d];break}this.casinoGames[d].selected=!1}}else this.movingObject.selected=!1,this.movingObject=0;else if("sell"==this.cursorMode){for(var d=0;500>d;d++)if(0!=this.doodads[d]&&this.mouseWithinBounds(this.doodads[d].x,this.doodads[d].y,16,16)&&confirm("Do you want to sell this decoration?")){this.cash+=5,delete this.doodads[d],this.doodads[d]=0;break}for(var d=0;MaxGames>d;d++)if(0!=this.casinoGames[d]&&this.mouseWithinBounds(this.casinoGames[d].x,this.casinoGames[d].y,this.casinoGames[d].width,this.casinoGames[d].height)&&confirm("Do you want to sell this game?")){this.cash+=a[this.casinoGames[d].type],this.casinoGames[d].sold=!0,delete this.casinoGames[d],this.casinoGames[d]=0;break}}},this.mouseMoved=function(a){this.mX=a.pageX-this.fgC.offsetLeft,this.mY=a.pageY-this.fgC.offsetTop,"move"==this.cursorMode&&0!=this.movingObject&&(this.movingObject.x=16*Math.round(this.mX/16),this.movingObject.y=16*Math.round(this.mY/16))},this.mouseWithinBounds=function(a,b,c,d){return a<this.mX&&a+c>this.mX&&b<this.mY&&b+d>this.mY},this.pauseGame=function(){this.pause=1==this.pause?!1:!0},this.saveCasinoGame=function(){this.selectedGame.winRate=parseFloat(document.getElementById("gameWinRate").value),this.selectedGame.cashOut=parseFloat(document.getElementById("gameCashOut").value),this.selectedGame.costToPlay=parseFloat(document.getElementById("gameCostToPlay").value)},this.addGame=function(b){if(game.cash>a[b]){for(var c=!0,d=0;MaxGames>d;d++)if(0==this.casinoGames[d]){this.casinoGames[d]=new CasinoGame,this.casinoGames[d].setType(b),this.changeCursorMode("move"),this.movingObject=this.casinoGames[d],this.casinoGames[d].init(0,0,this.mgC,this.mgCxt),game.cash-=a[b],c=!1;break}1==c&&alert("You have maxed out the number of games you can own.")}else alert("If you buy anymore games you will go bankrupt.")},this.addDoodad=function(a){if(game.cash>10){for(var b=!0,c=0;500>c;c++)if(0==this.doodads[c]){this.doodads[c]=new Doodad,this.doodads[c].frame=a,this.cursorMode="move",this.movingObject=this.doodads[c],this.doodads[c].init(0,0,this.mgC,this.mgCxt),game.cash-=10,b=!1,this.amountOfDoodads++,this.popularity+=.5;break}1==b&&alert("You have maxed out the number of decorations you can own.")}else alert("If you buy anymore decorations you will go bankrupt.")},this.changeCursorMode=function(a){this.cursorMode=a,this.movingObject.x=0,this.movingObject.y=0,this.movingObject=0,"move"==this.cursorMode?(document.getElementById("move").className="buttonSelected",document.getElementById("select").className="button",document.getElementById("sell").className="button"):"select"==this.cursorMode?(document.getElementById("select").className="buttonSelected",document.getElementById("move").className="button",document.getElementById("sell").className="button"):(document.getElementById("sell").className="buttonSelected",document.getElementById("move").className="button",document.getElementById("select").className="button")},fgC.addEventListener("mousedown",function(a){game.mouseClicked(a)},!1),fgC.addEventListener("mousemove",function(a){game.mouseMoved(a)},!1)}function Entity(){this.x=0,this.y=0,this.canvas=0,this.context=0,this.init=function(a,b,c,d){this.x=a,this.y=b,this.canvas=c,this.context=d},this.update=function(){},this.draw=function(){}}function Person(){this.goalX=Math.floor(640*Math.random()),this.goalY=Math.floor(480*Math.random()),this.thought="wandering",this.cash=Math.ceil(500*Math.random()),Math.random()<game.popularity/100&&(this.cash+=2e3),this.mood=100,this.gameImPlaying=0,this.imPlayerNumber=0,this.selected=!1,this.gone=!1,this.temperament=Math.ceil(3*Math.random()),this.frame=0,this.ticks=Math.floor(1e3*Math.random()),this.image=0,this.cash>500?(this.image=personHighRollerImage,this.temperament=5):this.image=personImage,this.update=function(){switch(this.ticks++,this.mood>100&&(this.mood=100),this.thought){case"wandering":this.closeToGoal()&&(this.goalX=Math.floor(640*Math.random()),this.goalY=Math.floor(480*Math.random())),(this.cash<=0||this.mood<=0)&&(this.thought="leave"),0==this.ticks%30&&(this.mood-=Math.ceil(this.temperament/2)),0==this.ticks%120&&(this.thought="findGameToPlay"),this.move();break;case"findGameToPlay":for(var a=0;MaxGames>a;a++)if(0!=game.casinoGames[a]&&game.casinoGames[a].currentPlayers<game.casinoGames[a].maxPlayers&&game.casinoGames[a].costToPlay<this.cash&&game.casinoGames[a]!=game.movingObject){this.gameImPlaying=game.casinoGames[a],this.thought="moveToGame";break}0==this.gameImPlaying&&(this.thought="wandering",this.mood-=this.temperament,game.popularity--);break;case"moveToGame":this.goalX=this.gameImPlaying.x,this.goalY=this.gameImPlaying.y,this.move(),this.closeToGoal()&&(this.gameImPlaying.currentPlayers>=this.gameImPlaying.maxPlayers?(this.gameImPlaying=0,this.thought="findGameToPlay",this.mood-=Math.ceil(this.temperament/2)):(this.thought="playGame",this.imPlayerNumber=this.gameImPlaying.currentPlayers,this.gameImPlaying.currentPlayers++));break;case"playGame":if(this.frame=1,1==this.gameImPlaying.sold&&(delete this.gameImPlaying,this.gameImPlaying=0,this.thought="wandering"),this.goalX!=this.gameImPlaying.x||this.goalY!=this.gameImPlaying.y){this.gameImPlaying.currentPlayers--,this.gameImPlaying=0,this.thought="findGameToPlay";break}this.gameImPlaying.height>16&&(this.y=this.gameImPlaying.y+16,this.x=this.gameImPlaying.x+16*this.imPlayerNumber),this.cash<this.gameImPlaying.costToPlay&&(this.thought="wandering",this.gameImPlaying.currentPlayers-=1,this.gameImPlaying=0),0==this.ticks%60&&(this.cash-=this.gameImPlaying.costToPlay,game.cash+=this.gameImPlaying.costToPlay,1==this.gameImPlaying.didIWin()?(this.cash+=this.gameImPlaying.cashOut,this.mood+=10,game.popularity++):this.mood-=Math.ceil(this.temperament/2)),this.mood<=0&&(this.thought="leave",this.gameImPlaying.currentPlayers-=1,this.gameImPlaying=0);break;case"leave":this.goalX=doorX+16,this.goalY=doorY+16,this.closeToGoal()&&(this.mood<=30&&(game.popularity-=5,this.temperament>4&&(game.popularity-=5)),this.gone=!0),this.move()}},this.draw=function(){1==this.selected&&(this.context.fillStyle="#54FF29",this.context.fillRect(this.x-1,this.y-1,18,18)),this.context.drawImage(this.image,16*this.frame,0,16,16,this.x,this.y,16,16)},this.move=function(){this.x>this.goalX?(this.x-=1,this.frame=2):this.x<this.goalX&&(this.x+=1,this.frame=3),this.y>this.goalY?(this.y-=1,this.frame=1):this.y<this.goalY&&(this.y+=1,this.frame=0)},this.closeToGoal=function(){return Math.abs(this.x-this.goalX)<1&&Math.abs(this.y-this.goalY)<1}}function CasinoGame(){this.winRate=.5,this.cashOut=100,this.costToPlay=0,this.upKeep=0,this.maxPlayers=0,this.type="",this.sold=!1,this.width=16,this.height=16,this.frame=0,this.ticks=0,this.frameCount=0,this.selected=!1,this.currentPlayers=0,this.currentLoses=0,this.currentWins=0,this.setType=function(a){switch(this.type=a,a){case"slots":this.frameCount=1,this.maxPlayers=1,this.upKeep=1,this.costToPlay=1,this.cashOut=10,this.winRate=.1;break;case"roulette":this.frameCount=2,this.maxPlayers=5,this.width=32,this.height=32,this.upKeep=4.5,this.costToPlay=15,this.cashOut=20,this.winRate=.3;break;case"blackjack":this.frameCount=2,this.maxPlayers=3,this.width=32,this.height=32,this.upKeep=2,this.costToPlay=15,this.cashOut=20,this.winRate=.3;break;case"craps":this.frameCount=2,this.maxPlayers=6,this.width=32,this.height=32,this.upKeep=3,this.costToPlay=15,this.cashOut=20,this.winRate=.3}},this.update=function(){this.ticks++,this.ticks>60&&(this.currentPlayers>0?this.frame++:this.frame=0,game.cash+=this.currentLoses*this.costToPlay-this.currentWins*this.cashOut-this.upKeep,this.currentLoses=0,this.currentWins=0,this.ticks=0),this.frame>=this.frameCount&&(this.frame=0)},this.draw=function(){1==this.selected&&(this.context.fillStyle="#54FF29",this.context.fillRect(this.x-1,this.y-1,this.width+2,this.height+2));var a=0;switch(this.type){case"slots":a=slotsImage;break;case"roulette":a=rouletteImage;break;case"blackjack":a=blackjackImage;break;case"craps":a=crapsImage}this.context.drawImage(a,this.width*this.frame,0,this.width,this.height,this.x,this.y,this.width,this.height)},this.didIWin=function(){var a=Math.random();return this.winRate<a?(this.currentLoses++,!1):(this.currentWins++,!0)}}function Doodad(){this.frame=0,this.selected=!1,this.draw=function(){1==this.selected&&(this.context.fillStyle="#54FF29",this.context.fillRect(this.x-1,this.y-1,18,18)),this.context.drawImage(doodadImage,16*this.frame,0,16,16,this.x,this.y,16,16)}}function StartGame(){game.init(),run()}function run(){thisFrame=Date.now(),elapsed=thisFrame-lastFrame,lastFrame=thisFrame,document.getElementById("fps-text").innerHTML=avgFramerate,game.run(),0==game.stoppedRunning&&requestAnimFrame(run),frameCount++,elapsedCounter+=elapsed,elapsedCounter>1e3&&(elapsedCounter-=1e3,avgFramerate=frameCount,frameCount=0)}var avgFramerate=0,frameCount=0,elapsedCounter=0,lastFrame=Date.now(),thisFrame,elapsed,personImage=new Image;personImage.src="Person.png";var personHighRollerImage=new Image;personHighRollerImage.src="PersonHighRoller.png";var crossImage=new Image;crossImage.src="cross.png";var magnifyingImage=new Image;magnifyingImage.src="magnifyingglass.png";var doorImage=new Image;doorImage.src="door.png";var floorImage=new Image;floorImage.src="floor.png";var floorPattern=0;floorImage.onload=function(){var a=document.getElementById("bgC"),b=a.getContext("2d");floorPattern=b.createPattern(floorImage,"repeat")};var slotsImage=new Image;slotsImage.src="SlotMachine.png";var rouletteImage=new Image;rouletteImage.src="roulettewheel.png";var blackjackImage=new Image;blackjackImage.src="blackjack.png";var crapsImage=new Image;crapsImage.src="craps.png";var doodadImage=new Image;doodadImage.src="doodads.png";var StartingAttendance=10,MaxAttendance=500,MaxGames=100,doorX=320,doorY=448,goodEvents=new Array(2);goodEvents[0]="You have won an award!  Here's your prize!",goodEvents[1]="You are the most fun casino around!  Here's a bonus!";var badEvents=new Array(3);badEvents[0]="Someone broke in and stole money!",badEvents[1]="A slot machine malfunctioned and emptied its contents.",badEvents[2]="A fee is being charged by the state.",Person.prototype=new Entity,CasinoGame.prototype=new Entity,Doodad.prototype=new Entity;var game=new Game;window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}();